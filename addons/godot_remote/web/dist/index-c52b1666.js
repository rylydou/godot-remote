(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();function D(t,e){const i=t.parentElement;if(!i)throw new Error("This canvas has no parent.");const r=new ResizeObserver((n,o)=>{j(t,n[0]),e&&e()});try{r.observe(i,{box:"device-pixel-content-box"})}catch{r.observe(i,{box:"content-box"})}return{destroy(){r.disconnect()}}}function j(t,e){if(e.devicePixelContentBoxSize){t.width=Math.round(e.devicePixelContentBoxSize[0].inlineSize),t.height=Math.round(e.devicePixelContentBoxSize[0].blockSize);return}let i=window.devicePixelRatio;if(e.contentBoxSize){if(e.contentBoxSize[0]){t.width=Math.round(e.contentBoxSize[0].inlineSize*i),t.height=Math.round(e.contentBoxSize[0].blockSize*i);return}t.width=Math.round(e.contentBoxSize.inlineSize*i),t.height=Math.round(e.contentBoxSize.blockSize*i);return}t.width=Math.round(e.contentRect.width*i),t.height=Math.round(e.contentRect.height*i)}const $=20,q=3e3,p=16,N="gwc:session_id";function Y(t){const e={api:t(n=>e.send_packet(n)),send_packet(n){e.ws&&e.ws.send(n)},ws:null,ws_address:"",auto_reconnect:!0,is_connected:!1,status:"Connecting...",connect(n){e.ws&&e.ws.readyState!=3&&e.ws.close(1e3,"Automatic close due to error."),e.ws_address=n,e.ws=new WebSocket(n),r()},on_status_change:()=>{},session_id:0,ongoing_pings:0,last_pong_timestamp:0,last_ping:0,ping_sum:0,ping_count:0,get_avg_ping:()=>e.ping_sum/Math.max(e.ping_count,1),ping_server(){e.ongoing_pings++,e.api.send_ping(Date.now())}},i=Math.floor(Math.random()*1e5);e.session_id=Number(sessionStorage.getItem(N)||i),sessionStorage.setItem(N,e.session_id.toString()),e.api.receive_ping=n=>{e.api.send_pong(n,Date.now())},e.api.receive_pong=(n,o)=>{const c=Date.now(),_=c-n;e.ongoing_pings--,e.last_ping=_,e.last_pong_timestamp=c,e.ping_sum+=_,e.ping_count++};function r(){if(!e.ws){console.error("[Websocket] Cannot listen to WebSocket client. One has not been made made.");return}e.ws.onmessage=n=>{console.debug("[WebSocket] Message: ",n.data),e.api.handle_packet(n.data)},e.ws.onopen=n=>{console.log("[WebSocket] Opened"),e.status="Connected",e.is_connected=!0,e.on_status_change&&e.on_status_change(),e.api.send_session(e.session_id)},e.ws.onclose=n=>{console.log("[WebSocket] Closed: ",{code:n.code,reason:n.reason,was_clean:n.wasClean}),e.status="Disconnected",e.is_connected=!1,e.on_status_change&&e.on_status_change()},e.ws.onerror=n=>{console.error("[WebSocket] Error: ",n),e.status="Error: "+n.toString(),e.is_connected=!1,e.on_status_change&&e.on_status_change(),e.auto_reconnect&&e.connect(e.ws_address)}}return e}function G(t,e){return t*t+e*e}function W(t,e){return Math.sqrt(t*t+e*e)}function A(t,e,i,r){const n=i-t,o=r-e;return G(n,o)}function J(t,e,i){const r=W(t,e),n=Math.min(r,i)/r;return[t*n,e*n]}function K(t,e){return Math.atan2(e,t)}function U(t,e){return[Math.cos(t)*e,Math.sin(t)*e]}function C(t,e,i){const r=(i==null?void 0:i.label)||"",n=(i==null?void 0:i.center_x)||0,o=(i==null?void 0:i.center_y)||0,c=(i==null?void 0:i.radius)||3,_=.5;let M=0,u=!1,O=!1;const y={client:t,sync(a){t.is_connected&&(!a&&O==u||(O=u,t.api.send_input_btn(e,O)))},down(a,S,w){u||A(n,o,a,S)<=c*c&&(u=!0,M=w,y.sync(!1))},up(a,S,w){u&&w==M&&(u=!1,y.sync(!1))},render(a){a.translate(n,o),a.beginPath(),a.ellipse(0,0,c,c,0,0,7),u&&a.fill(),a.lineWidth=_,a.stroke(),u&&(a.globalCompositeOperation="destination-out"),a.font=`bold ${c}px Bespoke Sans`,a.textAlign="center",a.textBaseline="middle",a.fillText(r,0,0),a.globalCompositeOperation="source-over"}};return y}function F(t,e,i){const r=(i==null?void 0:i.radius)||4,n=(i==null?void 0:i.padding)||1,o=.5,c=1,_=3,M=.5,u=(i==null?void 0:i.label)||"",O=8,y=2;let a=!1,S=0,w=(i==null?void 0:i.center_x)||0,x=(i==null?void 0:i.center_y)||0,f=0,g=0,B=0,E=0;const I={client:t,sync(s){if(!t.is_connected)return;let b=K(f,g),h=W(f,g);const P=O/(2*Math.PI);b=Math.round(b*P)/P,h=Math.round(h*y)/y;let[R,L]=U(b,h);!s&&R==B&&L==E||(B=R,E=L,t.api.send_input_joy(e,B,E))},down(s,b,h){a||(A(w,x,s,b)<=(r+n)*(r+n)&&(a=!0,S=h),I.sync(!1))},move(s,b,h){if(!a||h!=S)return;f=(s-w)/r,g=(b-x)/r;const P=J(f,g,1);f=P[0],g=P[1]},up(s,b,h){a&&h==S&&(a=!1,f=0,g=0,I.sync(!1))},render(s){s.translate(w,x),s.lineCap="round",s.beginPath(),s.ellipse(0,0,r+n,r+n,0,0,7),s.lineWidth=o,s.stroke(),s.beginPath(),s.ellipse(f*r,g*r,_+M,_+M,0,0,7),s.globalCompositeOperation="destination-out",s.fill(),s.globalCompositeOperation="source-over",s.beginPath(),s.moveTo(0,0),s.lineTo(f*r,g*r),s.lineWidth=c,s.stroke(),s.beginPath(),s.ellipse(f*r,g*r,_,_,0,0,7),s.fill(),s.font=`bold ${_}px Bespoke Sans`,s.textAlign="center",s.textBaseline="middle",s.globalCompositeOperation="destination-out",s.fillText(u,f*r,g*r),s.globalCompositeOperation="source-over"}};return I}function X(t){function e(n){var o=JSON.stringify(n);t(o)}function i(n){return Math.round(n*100)/100}const r={send_packet:t,handle_packet(n){const o=JSON.parse(n);switch(o._){case"ping":r.receive_ping(o.sts);break;case"pong":r.receive_pong(o.sts,o.rts);break;case"sync":r.receive_sync(o.id);break;case"sync_all":r.receive_sync_all();break;case"layout":r.receive_layout(o.id);break;case"alert":r.receive_alert(o.title,o.body);break;case"banner":r.receive_banner(o.text);break;case"clear_banner":r.receive_clear_banner();break}},receive_ping(n){},receive_pong(n,o){},receive_sync(n){},receive_sync_all(){},receive_layout(n){},receive_alert(n,o){},receive_banner(n){},receive_clear_banner(){},send_ping(n){e({_:"ping",sts:n})},send_pong(n,o){e({_:"pong",sts:n,rts:o})},send_input_btn(n,o){e({_:"input",id:n,d:o})},send_input_axis(n,o){e({_:"input",id:n,v:i(o)})},send_input_joy(n,o,c){e({_:"input",id:n,x:i(o),y:i(c)})},send_name(n){e({_:"name",name:n})},send_session(n){e({_:"session",sid:n})},send_layout_ready(n){e({_:"layout_ready",id:n})}};return r}const Z=X,d=Y(Z);d.on_status_change=z;d.connect(`ws://${window.location.hostname}:8081`);const T=document.getElementById("canvas"),l=T.getContext("2d");let m=0,k=0;setInterval(()=>{d.is_connected&&(d.ongoing_pings>0||d.is_connected&&d.ping_server())},q);setInterval(()=>{if(d.is_connected)for(const t of v)t.sync(!1)},1e3/$);D(T,()=>{m=l.canvas.width/window.devicePixelRatio/p,k=l.canvas.height/window.devicePixelRatio/p,v=[C(d,"a",{label:"A",center_x:m-4,center_y:k-9}),C(d,"b",{label:"B",center_x:m-9,center_y:k-4}),C(d,"x",{label:"X",center_x:m-9,center_y:k-4-10}),C(d,"y",{label:"Y",center_x:m-4-10,center_y:k-9}),F(d,"l",{label:"L",radius:4,padding:1,center_x:8,center_y:k-8})],z()});let v=[];function z(){l.resetTransform(),l.clearRect(0,0,l.canvas.width,l.canvas.height),l.scale(window.devicePixelRatio*p,window.devicePixelRatio*p),l.fillStyle="white",l.strokeStyle="white";for(const e of v)e.render&&(l.save(),e.render(l),l.restore());l.font="normal 1px sans-serif",l.textAlign="center",l.textBaseline="top";let t=d.status;d.is_connected&&(t=`${Math.round(d.last_ping)}ms (${Math.round(d.get_avg_ping())}ms)`),l.fillText(t,m/2,1,m*.9)}function H(t,e,i){t=t/p,e=e/p;for(const r of v)r.down&&r.down(t,e,i);for(const r of v)r.move&&r.move(t,e,i);z()}function Q(t,e,i){t=t/p,e=e/p;for(const r of v)r.move&&r.move(t,e,i);z()}function V(t,e,i){t=t/p,e=e/p;for(const r of v)r.up&&r.up(t,e,i);z()}window.addEventListener("pointerdown",t=>{t.preventDefault(),H(t.x,t.y,t.pointerId)});window.addEventListener("pointerup",t=>{t.preventDefault(),V(t.x,t.y,t.pointerId)});window.addEventListener("pointermove",t=>{t.preventDefault(),Q(t.x,t.y,t.pointerId)});T.addEventListener("touchstart",t=>t.preventDefault());
