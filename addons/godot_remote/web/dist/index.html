<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="shortcut icon" href="favicon.svg" type="image/x-icon"><title>Controller</title><link href="https://api.fontshare.com/v2/css?f[]=bespoke-sans@800&display=swap" rel="stylesheet"><script type="module">
function G(e,n){const t=e.parentElement;if(!t)throw new Error("This canvas has no parent.");const r=new ResizeObserver((i,o)=>{U(e,i[0]),n&&n()});try{r.observe(t,{box:"device-pixel-content-box"})}catch{r.observe(t,{box:"content-box"})}return{destroy(){r.disconnect()}}}function U(e,n){if(n.devicePixelContentBoxSize){e.width=Math.round(n.devicePixelContentBoxSize[0].inlineSize),e.height=Math.round(n.devicePixelContentBoxSize[0].blockSize);return}let t=window.devicePixelRatio;if(n.contentBoxSize){if(n.contentBoxSize[0]){e.width=Math.round(n.contentBoxSize[0].inlineSize*t),e.height=Math.round(n.contentBoxSize[0].blockSize*t);return}e.width=Math.round(n.contentBoxSize.inlineSize*t),e.height=Math.round(n.contentBoxSize.blockSize*t);return}e.width=Math.round(n.contentRect.width*t),e.height=Math.round(n.contentRect.height*t)}const Y=20,K=3e3,W=16,x="gremote:session_id";function F(e){const n={api:e,reconnect_address:"",auto_reconnect:!0,is_connected:!1,status:"Connecting...",connect(r){n.reconnect_address=r,e.driver.connect(r)},session_id:0,ongoing_pings:0,last_pong_timestamp:0,last_ping:0,ping_sum:0,ping_count:0,get_avg_ping:()=>n.ping_sum/Math.max(n.ping_count,1),ping_server(){n.ongoing_pings++,n.api.send_ping(Date.now())}},t=Math.floor(Math.random()*1e5);return n.session_id=Number(sessionStorage.getItem(x)||t),sessionStorage.setItem(x,n.session_id.toString()),n.api.receive_ping=r=>{n.api.send_pong(r,Date.now())},n.api.receive_pong=(r,i)=>{const o=Date.now(),s=o-r;n.ongoing_pings--,n.last_ping=s,n.last_pong_timestamp=o,n.ping_sum+=s,n.ping_count++},n.api.driver.on_open=()=>{console.log("[Client] Connecting. Sending session id."),e.send_session(n.session_id),n.is_connected=!0},n.api.driver.on_close=()=>{n.is_connected=!1,n.auto_reconnect&&(console.log("[Client] Auto reconnecting due to disconnect."),n.api.driver.connect(n.reconnect_address))},n}function X(e,n){return e*e+n*n}function $(e,n){return Math.sqrt(e*e+n*n)}function D(e,n,t,r){const i=t-e,o=r-n;return X(i,o)}function Z(e,n,t){const r=$(e,n),i=Math.min(r,t)/r;return[e*i,n*i]}function H(e,n){return Math.atan2(n,e)}function Q(e,n){return[Math.cos(e)*n,Math.sin(e)*n]}function P(e,n,t){const r=(t==null?void 0:t.label)||"",i=(t==null?void 0:t.center_x)||0,o=(t==null?void 0:t.center_y)||0,s=(t==null?void 0:t.radius)||3,f=.5;let l=0,u=!1,h=!1;const w={client:e,sync(a){e.is_connected&&(!a&&h==u||(h=u,e.api.send_input_btn(n,h)))},down(a,k,y){u||D(i,o,a,k)<=s*s&&(u=!0,l=y,w.sync(!1))},up(a,k,y){u&&y==l&&(u=!1,w.sync(!1))},render(a){a.translate(i,o),a.beginPath(),a.ellipse(0,0,s,s,0,0,7),u&&a.fill(),a.lineWidth=f,a.stroke(),u&&(a.globalCompositeOperation="destination-out"),a.font=`bold ${s}px Bespoke Sans`,a.textAlign="center",a.textBaseline="middle",a.fillText(r,0,0),a.globalCompositeOperation="source-over"}};return w}function V(e,n,t){const r=(t==null?void 0:t.radius)||4,i=(t==null?void 0:t.padding)||1,o=.5,s=1,f=3,l=.5,u=(t==null?void 0:t.label)||"",h=8,w=2;let a=!1,k=0,y=(t==null?void 0:t.center_x)||0,E=(t==null?void 0:t.center_y)||0,g=0,p=0,N=0,B=0;const L={client:e,sync(c){if(!e.is_connected)return;let m=H(g,p),b=$(g,p);const M=h/(2*Math.PI);m=Math.round(m*M)/M,b=Math.round(b*w)/w;let[j,J]=Q(m,b);!c&&j==N&&J==B||(N=j,B=J,e.api.send_input_joy(n,N,B))},down(c,m,b){a||(D(y,E,c,m)<=(r+i)*(r+i)&&(a=!0,k=b),L.sync(!1))},move(c,m,b){if(!a||b!=k)return;g=(c-y)/r,p=(m-E)/r;const M=Z(g,p,1);g=M[0],p=M[1]},up(c,m,b){a&&b==k&&(a=!1,g=0,p=0,L.sync(!1))},render(c){c.translate(y,E),c.lineCap="round",c.beginPath(),c.ellipse(0,0,r+i,r+i,0,0,7),c.lineWidth=o,c.stroke(),c.beginPath(),c.ellipse(g*r,p*r,f+l,f+l,0,0,7),c.globalCompositeOperation="destination-out",c.fill(),c.globalCompositeOperation="source-over",c.beginPath(),c.moveTo(0,0),c.lineTo(g*r,p*r),c.lineWidth=s,c.stroke(),c.beginPath(),c.ellipse(g*r,p*r,f,f,0,0,7),c.fill(),c.font=`bold ${f}px Bespoke Sans`,c.textAlign="center",c.textBaseline="middle",c.globalCompositeOperation="destination-out",c.fillText(u,g*r,p*r),c.globalCompositeOperation="source-over"}};return L}function ee(e,n,t){const r=(t==null?void 0:t.center_x)||0,i=(t==null?void 0:t.center_y)||0;let o=0,s=!1;return{client:e,down(l,u,h){s||D(r,i,l,u)<=4&&(s=!0,o=h)},up(l,u,h){s&&h==o&&(s=!1,n())},render(l){l.translate(r,i),l.beginPath(),s&&l.scale(.9,.9),l.moveTo(-1,-.5),l.lineTo(1,-.5),l.moveTo(-1,0),l.lineTo(1,0),l.moveTo(-1,.5),l.lineTo(1,.5),l.lineWidth=.25,l.stroke()}}}function ne(e){function n(o){return Math.round(o*100)/100}function t(o){e.send_reliable(JSON.stringify(o))}function r(o){e.send_unreliable(JSON.stringify(o))}const i={driver:e,receive_ping(o){},receive_pong(o,s){},receive_sync(o){},receive_sync_all(){},receive_layout(o){},receive_alert(o,s){},receive_banner(o){},receive_clear_banner(){},send_ping(o){t({_:"ping",sts:o})},send_pong(o,s){t({_:"pong",sts:o,rts:s})},send_input_btn(o,s){t({_:"input",id:o,d:s})},send_input_axis(o,s){r({_:"input",id:o,v:n(s)})},send_input_joy(o,s,f){r({_:"input",id:o,x:n(s),y:n(f)})},send_name(o){t({_:"name",name:o})},send_session(o){t({_:"session",sid:o})},send_layout_ready(o){t({_:"layout_ready",id:o})}};return i.driver.on_message=o=>{const s=JSON.parse(o);if(!s){console.error("[JSON API] Cannot parse packet. The packet is not valid json.");return}if(!s._){console.error("[JSON API] Cannot parse packet. The packet is missing and type and is therefore corrupt.");return}switch(s._){case"ping":i.receive_ping(s.sts);break;case"pong":i.receive_pong(s.sts,s.rts);break;case"sync":i.receive_sync(s.id);break;case"sync_all":i.receive_sync_all();break;case"layout":i.receive_layout(s.id);break;case"alert":i.receive_alert(s.title,s.body);break;case"banner":i.receive_banner(s.text);break;case"clear_banner":i.receive_clear_banner();break;default:console.error("[JSON API] Unknown packet type: ",s._);break}},i}function te(){let e=null;const n={connect(t){console.log("[WebSocket] Address",t),e=new WebSocket(t),e.onmessage=r=>{console.debug("[WebSocket] Message: ",r.data),n.on_message&&n.on_message(r.data)},e.onopen=r=>{console.log("[WebSocket] Opened"),n.on_open&&n.on_open(),n.on_status_change&&n.on_status_change()},e.onclose=r=>{console.log("[WebSocket] Closed"),n.on_close&&n.on_close(),n.on_status_change&&n.on_status_change()},e.onerror=r=>{console.error("[WebSocket] Error: ",r),n.disconnect(),n.on_error&&n.on_error(r)},n.on_status_change&&n.on_status_change()},disconnect(){e==null||e.close(),n.on_status_change&&n.on_status_change()},get_status(){if(!e)return"uninitialized";switch(e.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"open";case WebSocket.CLOSED:return"closed";case WebSocket.CLOSING:return"closing"}return"initialized"},send_reliable(t){e==null||e.send(t)},send_unreliable(t){e==null||e.send(t)}};return n}const re=te(),oe=ne(re),d=F(oe);d.api.driver.on_status_change=I;const C=document.getElementById("canvas"),_=C.getContext("2d"),A=document.getElementById("menu");let T=!1,v=0,O=0;function R(e,n){return e=e/W,n=n/W,[e,n]}function z(){return window.devicePixelRatio*W}setInterval(()=>{d.is_connected&&(d.ongoing_pings>0||d.is_connected&&d.ping_server())},K);setInterval(()=>{if(d.is_connected)for(const e of S)e.sync&&e.sync(!1)},1e3/Y);G(C,()=>{v=_.canvas.width/z(),O=_.canvas.height/z(),S=[ee(d,()=>{T=!0,q()},{center_x:v-2,center_y:2}),P(d,"a",{label:"A",center_x:v-4,center_y:O-9}),P(d,"b",{label:"B",center_x:v-9,center_y:O-4}),P(d,"x",{label:"X",center_x:v-9,center_y:O-4-10}),P(d,"y",{label:"Y",center_x:v-4-10,center_y:O-9}),V(d,"l",{label:"L",radius:4,padding:1,center_x:8,center_y:O-8})],I()});let S=[];function I(){_.resetTransform(),_.clearRect(0,0,_.canvas.width,_.canvas.height),_.scale(z(),z()),_.fillStyle="white",_.strokeStyle="white";for(const e of S)e.render&&(_.save(),e.render(_),_.restore());_.save(),ie(),_.restore()}function ie(){let e=d.api.driver.get_status();d.is_connected&&(e=`${Math.round(d.last_ping)}ms (${Math.round(d.get_avg_ping())}ms)`,_.globalAlpha=.25),_.font="bold 1px sans-serif",_.textAlign="center",_.textBaseline="top",_.fillText(e,v/2,1,v*.9)}function q(){T?(A.classList.add("open"),C.classList.add("open")):(A.classList.remove("open"),C.classList.remove("open"))}function se(e,n,t){if(T){e<A.clientWidth&&(T=!1,q());return}[e,n]=R(e,n);for(const r of S)r.down&&r.down(e,n,t);for(const r of S)r.move&&r.move(e,n,t);I()}function ce(e,n,t){[e,n]=R(e,n);for(const r of S)r.move&&r.move(e,n,t);I()}function ae(e,n,t){[e,n]=R(e,n);for(const r of S)r.up&&r.up(e,n,t);I()}window.addEventListener("pointerdown",e=>{e.preventDefault(),se(e.x,e.y,e.pointerId)});window.addEventListener("pointerup",e=>{e.preventDefault(),ae(e.x,e.y,e.pointerId)});window.addEventListener("pointermove",e=>{e.preventDefault(),ce(e.x,e.y,e.pointerId)});C.addEventListener("touchstart",e=>e.preventDefault());d.connect(`ws://${window.location.hostname}:8081`);

</script><style>
*{margin:unset;padding:unset;background:unset;color:unset;font:unset;border:unset}html,body{background-color:#000;color:#fff;font-family:"Bespoke Sans" sans-serif;max-width:100dvw;max-height:100dvh;user-select:none;-webkit-user-select:none;overflow:hidden;overscroll-behavior:none;font-size:1rem;line-height:1.5rem}canvas{background-color:#000;position:absolute;width:100%;height:100%;transition:filter .1s}canvas.open{filter:opacity(.25) blur(8px);transition:filter .2s}#menu{translate:100% 0%;position:fixed;top:0;right:0;bottom:0;left:50%;display:flex;flex-direction:column;overflow-y:scroll;overflow-x:none;color:#000;background-color:#fff;visibility:hidden;transition:translate .1s linear,visibility 0ms .1s}#menu.open{translate:0% 0%;visibility:visible;transition:translate .2s ease-out}#menu>*{display:flex;justify-content:space-between;align-items:center;gap:1rem;min-height:2rem;padding:1rem 2rem}#menu>:not(:first-child,:last-child){border-bottom:solid 1px lightgray}#menu>h1{font-family:"Bespoke Sans" sans-serif;font-size:1.5rem;line-height:2rem}#menu>button{cursor:pointer;font-family:sans-serif;font-weight:700}#menu>button>:last-child{font-weight:400;opacity:.5}

</style></head><body><div style="width:100%;height:100%;min-height:100dvh"><canvas id="canvas"></canvas></div><div id="menu"><h1>Menu</h1><button><span>Change name</span><span>Unnamed</span></button> <button>Takeover controller</button> <button>Disconnect</button> <button>Debug menu</button></div></body></html>